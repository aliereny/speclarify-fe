# Operations & Developer Notes

These notes capture the day-to-day commands, environment configuration, and troubleshooting tips for the Speclarify frontend.

## Scripts
- `npm run dev` — launches Next.js in development mode. Automatically executes `ts-node ./scripts/genAntdCss.tsx` via the `predev` hook.
- `npm run build` — production build with `prebuild` hook regenerating `public/antd.min.css` under `NODE_ENV=production`.
- `npm run start` — serves the build output.
- `npm run lint` — checks TypeScript/JavaScript files against `eslint-config-next` and Prettier rules.

> Tip: There is no test runner configured yet. When you introduce one (Jest, Vitest, etc.), add scripts and mention them here.

## Environment Variables
| Name | Scope | Purpose |
| ---- | ----- | ------- |
| `NEXT_PUBLIC_API_URL` | client | Base URL for axios requests. Defaults to `https://api.speclarify.com/api/v1`. |
| `API_URL` | server | Optional base for the export download link (used in `src/app/projects/[projectId]/(steps)/export/page.tsx`). |

Create `.env.local` in development; Next.js automatically loads it.

## Generated Assets
- `public/antd.min.css` is generated by `scripts/genAntdCss.tsx` using `@ant-design/static-style-extract`. Do not edit manually. Regenerate by rerunning any command with the `pre*` hooks if you tweak Ant Design tokens.

## Persistent Storage Keys
Speclarify uses Zustand's `persist` middleware. Local data lives in browser `localStorage` under:
- `auth-storage` — `accessToken`, `refreshToken`.
- `projects` — cached array of projects with fallback metadata.
- `requirements` — requirements, duplicates, inconsistencies, and ambiguities for the active project.

Clear these keys when switching between backend environments or testing authentication flows.

## Axios Client Behavior
- Configured in `src/data/axiosClient.ts`.
- Adds `Authorization: Bearer <token>` when `useAuthStore` has an access token.
- On `401` responses, sets `_retry` to prevent loops, posts `{ refresh_token }` to `/refresh`, updates the access token, and retries the original request.
- Requests default to `application/json`; uploads override headers within store actions when sending `FormData`.

## Common Issues
- **Refresh token invalid** — the app will surface repeat `401` errors. Log out via the UI or clear `auth-storage` in localStorage.
- **Uploads failing** — ensure the backend accepts `multipart/form-data` at `/projects/:id/parse-pdf` or `/interviews`. The UI intentionally prevents automatic uploads by returning `false` in the file uploader.
- **Broken layout on small screens** — verify `useWindowDimensions` is functioning; it drives responsive card orientation.
- **Step navigation misaligned** — `src/app/projects/[projectId]/(steps)/layout.tsx` defines the canonical step order. Update both the `routes` array and `Steps` items together.

## Deployment Notes
- This repository focuses solely on the frontend. Deploy via Vercel, Netlify, or any static host capable of running Next.js 13 with Node 18+.
- Ensure environment variables are set in your hosting provider and that the backend API is reachable from the deployed origin.

Keep this document updated as build tooling evolves or new operational quirks emerge.
